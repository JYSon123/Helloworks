<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.!! 팀원님들 각자 하나씩 만드셔요) ==== -->
<mapper namespace="sonjy">
	
	<!-- 작성한 문서를 테이블에 insert 시켜주는 메소드 -->
	<insert id="addEnd" parameterType="HashMap">
		insert into TBL_DOCUMENT(doument_seq, fk_empno, fk_deptnum, name, subject, content, regDate, status, result)
		values(to_char(sysdate, 'yyyymmdd') || to_char(documentSeq.nextval), #{fk_empno}, #{fk_deptnum}, #{name}, #{subject}, #{content}, sysdate, #{status}, default)
	</insert>
	
	
	<!-- 총 게시물 건수(totalCount)를 알아오는 메소드 -->
    <select id="getTotalCount" parameterType="HashMap" resultType="int">
	  <if test='searchType == "" and searchWord == ""'>
	  	select count(*)
	    from TBL_DOCUMENT
	  </if>
	  
      <if test='searchType != "" and searchWord != ""'>
      	select count(*)
	    from TBL_DOCUMENT
		where  status = ${searchType} and result = ${searchWord}
      </if>
      
	  <if test='searchType != "" and searchWord == ""'>
	  	select count(*)
	    from TBL_DOCUMENT
		where status = ${searchType}
      </if>
      
      <if test='searchType == "" and searchWord != ""'>
      	select count(*)
	    from TBL_DOCUMENT
		where result = ${searchWord}
      </if>	
      
   </select>
   
   
   <select id="documentListSearchWithPaging" parameterType="HashMap" resultType="com.spring.employees.model.DocumentVO_jy">
	    
	    <if test='searchType == "" and searchWord == ""'>
	     select doument_seq, fk_empno, fk_deptnum, name, subject, content, regDate, status, result, filename
			from 
			(
			    select row_number() over(order by doument_seq desc) AS rno, doument_seq, fk_empno, fk_deptnum, name, subject, content, to_char(regDate, 'yyyy-mm-dd hh24:mi:ss' ) AS regDate, status, result, filename
			    from TBL_DOCUMENT
			) V
	  	 where rno between #{startRno} and #{endRno}
	  	</if>
	  	
	  	<if test='searchType != "" and searchWord != ""'>
	     select doument_seq, fk_empno, fk_deptnum, name, subject, content, regDate, status, result, filename
			from 
			(
			    select row_number() over(order by doument_seq desc) AS rno, doument_seq, fk_empno, fk_deptnum, name, subject, content, to_char(regDate, 'yyyy-mm-dd hh24:mi:ss' ) AS regDate, status, result, filename
			    from TBL_DOCUMENT
			    where status = ${searchType} and result = ${searchWord}
			) V
	  	 where rno between #{startRno} and #{endRno}
	  	</if>
	  	
	  	<if test='searchType != "" and searchWord == ""'>
	     select doument_seq, fk_empno, fk_deptnum, name, subject, content, regDate, status, result, filename
			from 
			(
			    select row_number() over(order by doument_seq desc) AS rno, doument_seq, fk_empno, fk_deptnum, name, subject, content, to_char(regDate, 'yyyy-mm-dd hh24:mi:ss' ) AS regDate, status, result, filename
			    from TBL_DOCUMENT
			    where status = ${searchType}
			) V
	  	 where rno between #{startRno} and #{endRno}
	  	</if>
	  	
	    <if test='searchType == "" and searchWord != ""'>
	     select doument_seq, fk_empno, fk_deptnum, name, subject, content, regDate, status, result, filename
			from 
			(
			    select row_number() over(order by doument_seq desc) AS rno, doument_seq, fk_empno, fk_deptnum, name, subject, content, to_char(regDate, 'yyyy-mm-dd hh24:mi:ss' ) AS regDate, status, result, filename
			    from TBL_DOCUMENT
			    where result = ${searchWord}
			) V
	  	 where rno between #{startRno} and #{endRno}
	  	</if>
    
	
	</select>
	
</mapper>